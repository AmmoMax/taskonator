![Bot](img/bot.jpg "Bot")
# Телеграм бот для получения и сдачи заданий

---

Функционал МВП:

- админ может создать задание
- админ может посмотреть список текущих заданий
- админ видит список заданий ожидающих оценки
- пользователь может посмотреть список заданий
- пользователь может записать одно задание на себя
- пользователь может сдать задание

---

## Общее описание сервиса

Функциональные части:

- админка
- интерфейс пользователя

### Как должно работать:

Администратор публикует в бота задание с описанием, критериями выполнения, ценой и сроком действия.

Пользователь может запросить список доступных заданий, проверить свой баланс и взять себе одно из доступных заданий.

Далее пользователь выполняет задание и сдает. Задание встает на ожидание подтверждения от админа.

Админ видит список заданий ожидающих подтверждения, проверяет критерии сдачи и дальше два вариант

- все отлично - задание принимается, закрывается а пользователю начисляют баллы
- что то не так - задание отправляется на доработку с комментарием

### Бот для админа:

- управление заданиями - создание, изменение, удаление, аппрув ожидающих либо отказ с комментарием
- управление пользователями (в более полной версии)

### Бот пользователя:

- посмотреть список текущих заданий
- посмотреть свой баланс
- выбрать задание и записать на себя
- сдать задание

## Какие данные надо хранить в базе:

- пользователи
    - id
    - баланс
    - id текущего задания
    - статус - админ или обычный
- задания
    - id
    - описание
    - стоимость
    - картинка(если надо)
    - срок действия

Команды бота:

/start - команда начала работы. Проверяет пользователя если он новый, если он уже существует - выводит список текущих задач

/task_list - выводит список текущих заданий с клавиатурой - пользователь может нажать на кнопку чтобы взять задание

/my_tasks - посмотреть список моих заданий со статусами

/create_task - создать задание, бот ожидает несколько заполненных полей для задания(посмотреть как это можно лучше сделать)

/submit_task - сдать задание, команда для пользователя - попытаться сдать текущее задание


Сущности:

- Enum со списком команд
- Бот - слушает ТГ апи, обрабатывает входящие запросы, проверяет пользователей и задания - центральная точка
- Менеджер пользователей - хранит список пользователей, возвращает список пользователей или админов, добавляет пользователя, удаляет
  - Пользователь (?) - запрашивает список заданий, принимает одно задание, сдает задание, проверяет текущий баланс
- Менеджер заданий - хранит список заданий, возвращает свободные задания, меняет статусы у заданий, 
  - Задание (?)
- Интерфейс для работы с базой

Пользователь хочет взять задание - знаем пользователя, знаем задание -> можем связать их в UserManager
UserManager - хранит список пользователей и структуру связывающую задания и пользователей(?)
- добавить нового пользователя
- назначить пользователю задание
- проверить существует ли у пользователя активное задание
- 

Функционал администратора.Добавление нового задания.
Вариант реализации - добавить список команд для администратора - типа /create_task, но не выводить их в меню.
При вводе команды - включать специальный диалог по созданию нового задания:
  - введите описание задания - и следующее сообщение воспринимать как задание
  - введите срок действия - и следующее сообщение воспринимать как дедлайн по заданию
  - и тд
Что надо сделать:
Добавить валидацию данных для каждого шага и в конце добавлять новое задание через менеджер заданий(дописать у него соответствующий метод если потребуется.)
Так же при вводе команды проверять что пользователь который ее ввел - находится в списке админов.
Проверку типа пользователя выполнять через менеджер пользователей.
Подумать как сделать хэндлер таким чтобы не пихать в один метод всю простыню логики.


Менеджер заданий.
Список методов:
- получить список задач по статусу
- изменить статус задания по id


Примерная логика взимодействия Бота с другими компонентами:

 - /start -> проверяет id пользователя в менеджере -> возвращает список команд для админа или обычного пользователя
 - /task_list -> запросил список активных свободных заданий у TaskManager -> вернул ответ пользователю
 - сообщение от клиента - не команда -> пытается зарегистрировать это как задание для пользователя через TaskManager -> отправляет ответ клиенту (тут может быть два варианта: клиент нажал на кнопку и отправил реальное задание - тогда оно привязывается к нему и для него формируется ответ1, либо клиент просто написал сообщение которое не связано с заданием, тогда ему отправляется заглушка)
 - /create_task(только для админа) -> делает запрос в UserManager является ли этот пользователь админом -> Запускает диалог создания задания -> Добавляет новое задание через TaskManager
 - /submit_task -> запрос в UserManager для сдачи текущего задания -> отправляет пользователю ответ